# 麻雀牌検出システム - Webインターフェース

フェーズ3で実装されたWebベースのユーザーインターフェースです。教師データ作成システムと学習システムを統合し、直感的な操作を可能にします。

## 機能概要

### 1. ダッシュボード
- システム全体の状況を一目で確認
- 動画数、フレーム数、アノテーション数の統計表示
- 最近のアクティビティと学習進捗の可視化
- リアルタイムでの状態更新

### 2. データ管理
- **動画アップロード**: ドラッグ&ドロップによる直感的なアップロード
- **フレーム抽出**: 設定可能な間隔と品質閾値での自動抽出
- **データセット管理**: バージョン管理とエクスポート機能
- **統計表示**: データセット全体の詳細な統計情報

### 3. ラベリングインターフェース
- **インタラクティブキャンバス**: ズーム、パン機能付きの高機能エディタ
- **バウンディングボックス描画**: マウスによる直感的な領域選択
- **牌種類選択**: 37種類の麻雀牌に対応した選択UI
- **半自動ラベリング**: AIによる自動検出結果の表示と修正
- **進捗管理**: ラベリング状況の保存と復元

### 4. 学習管理
- **学習設定**: 詳細なハイパーパラメータ設定
- **リアルタイム監視**: WebSocketによる学習進捗のリアルタイム表示
- **結果可視化**: 学習履歴とメトリクスのグラフ表示
- **モデル比較**: 複数モデルの性能比較機能
- **継続学習**: 既存モデルからの転移学習サポート

## 技術仕様

### フロントエンド
- **HTML5 Canvas**: 高性能な画像編集とアノテーション
- **Bootstrap 5**: レスポンシブデザインとモダンUI
- **Chart.js**: インタラクティブなグラフとチャート
- **WebSocket**: リアルタイム通信とライブ更新

### バックエンド
- **Flask**: 軽量で柔軟なWebフレームワーク
- **Flask-SocketIO**: WebSocketサポート
- **SQLite**: 軽量データベース
- **OpenCV**: 画像・動画処理

### システム統合
- フェーズ1の教師データ作成システムとの完全統合
- フェーズ2の学習システムとの完全統合
- 既存のデータベースとファイル構造の活用

## インストールと起動

### 1. 依存関係のインストール
```bash
cd web_interface
pip install -r requirements.txt
```

### 2. 環境設定
```bash
# 環境変数の設定（オプション）
export FLASK_ENV=development
export HOST=0.0.0.0
export PORT=5000
```

### 3. アプリケーション起動
```bash
# 開発サーバーで起動
python run.py

# または直接起動
python app.py
```

### 4. アクセス
ブラウザで `http://localhost:5000` にアクセス

## ディレクトリ構造

```
web_interface/
├── app.py                    # メインアプリケーション
├── run.py                    # 起動スクリプト
├── config.py                 # 設定ファイル
├── requirements.txt          # 依存関係
├── README.md                 # このファイル
├── static/                   # 静的ファイル
│   ├── css/
│   │   └── style.css        # カスタムCSS
│   └── js/
│       ├── common.js        # 共通JavaScript
│       ├── labeling.js      # ラベリング機能
│       ├── training.js      # 学習管理機能
│       └── data_management.js # データ管理機能
├── templates/                # HTMLテンプレート
│   ├── base.html            # ベーステンプレート
│   ├── index.html           # ダッシュボード
│   ├── labeling.html        # ラベリングページ
│   ├── training.html        # 学習管理ページ
│   └── data_management.html # データ管理ページ
├── uploads/                  # アップロードファイル
└── logs/                     # ログファイル
```

## 使用方法

### 1. 動画のアップロードとフレーム抽出
1. 「データ管理」ページにアクセス
2. 動画ファイルをドラッグ&ドロップまたは選択してアップロード
3. フレーム抽出設定を調整（間隔、品質閾値など）
4. 自動フレーム抽出が実行される

### 2. ラベリング作業
1. 「ラベリング」ページにアクセス
2. 動画を選択してフレーム一覧を表示
3. フレームを選択して画像を表示
4. 牌種類を選択してバウンディングボックスを描画
5. 進捗を保存

### 3. 学習の実行
1. 「学習管理」ページにアクセス
2. 学習設定を入力（モデル名、データセット、パラメータ）
3. 学習を開始
4. リアルタイムで進捗を監視
5. 完了後にモデルをダウンロード

### 4. データセット管理
1. 「データ管理」ページでバージョンを作成
2. 必要に応じてYOLO/COCO形式でエクスポート
3. 学習に使用するデータセットを選択

## API エンドポイント

### 動画管理
- `POST /api/upload_video` - 動画アップロード
- `GET /api/videos` - 動画一覧取得
- `GET /api/videos/{id}` - 動画詳細取得
- `DELETE /api/videos/{id}` - 動画削除

### フレーム管理
- `POST /api/extract_frames` - フレーム抽出開始
- `GET /api/videos/{id}/frames` - フレーム一覧取得
- `GET /api/frames/{id}/annotations` - アノテーション取得
- `POST /api/frames/{id}/annotations` - アノテーション保存

### 学習管理
- `POST /api/training/start` - 学習開始
- `GET /api/training/sessions` - セッション一覧取得
- `POST /api/training/stop/{id}` - 学習停止
- `POST /api/training/compare` - モデル比較

### データセット管理
- `GET /api/dataset/statistics` - 統計情報取得
- `GET /api/dataset/versions` - バージョン一覧取得
- `POST /api/dataset/create_version` - バージョン作成
- `POST /api/dataset/export` - データセットエクスポート

## WebSocketイベント

### クライアント → サーバー
- `join_session` - セッションルームに参加
- `leave_session` - セッションルームから退出

### サーバー → クライアント
- `training_progress` - 学習進捗更新
- `frame_extraction_progress` - フレーム抽出進捗
- `export_progress` - エクスポート進捗

## セキュリティ

### 基本的なセキュリティ対策
- ファイルアップロードの拡張子チェック
- ファイルサイズ制限（500MB）
- セッション管理
- CSRF保護（本番環境）

### 推奨事項
- 本番環境では HTTPS を使用
- 適切なファイアウォール設定
- 定期的なバックアップ

## パフォーマンス

### 最適化機能
- 静的ファイルのキャッシュ
- 画像の遅延読み込み
- WebSocketによる効率的な通信
- データベースインデックス

### 推奨環境
- CPU: 4コア以上
- メモリ: 8GB以上
- ストレージ: SSD推奨
- GPU: CUDA対応（学習時）

## トラブルシューティング

### よくある問題

1. **動画アップロードが失敗する**
   - ファイルサイズが500MBを超えていないか確認
   - 対応形式（MP4, AVI, MOV等）か確認

2. **学習が開始されない**
   - データセットバージョンが選択されているか確認
   - 十分なアノテーションデータがあるか確認

3. **WebSocketが接続されない**
   - ファイアウォール設定を確認
   - ブラウザのWebSocket対応を確認

### ログの確認
```bash
# アプリケーションログ
tail -f web_interface/logs/web_interface.log

# システムログ（既存）
tail -f logs/system.log
```

## 開発者向け情報

### カスタマイズ
- `static/css/style.css` でスタイルをカスタマイズ
- `templates/` でHTMLテンプレートを編集
- `config.py` で設定を変更

### 新機能の追加
1. APIエンドポイントを `app.py` に追加
2. フロントエンド機能を対応するJSファイルに追加
3. 必要に応じてHTMLテンプレートを更新

### テスト
```bash
# 単体テスト実行
python -m pytest tests/

# 統合テスト実行
python -m pytest tests/integration/
```

## ライセンス

このプロジェクトは既存の麻雀牌検出システムの一部として、同じライセンスの下で提供されます。

## サポート

問題や質問がある場合は、プロジェクトのIssueトラッカーまでお知らせください。